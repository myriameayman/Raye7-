<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
  <title>Find a route using Geolocation and Google Maps API</title>
  <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script>
   
   function viewTrips() {
     var directionsService = new google.maps.DirectionsService();
     var directionsDisplay = new google.maps.DirectionsRenderer();
     var trips = <%= @trips.to_json.html_safe %>; 
     var route = [] ;

    var mapOptions = {
      center: new google.maps.LatLng(30.055487, 31.279766),
      zoom: 8,
      mapTypeId: google.maps.MapTypeId.NORMAL,
      panControl: true,
      scaleControl: false,
      streetViewControl: true,
      overviewMapControl: true
    };

    var rendererOptions = {
            preserveViewport: true,
                map:map,
                polylineOptions:{strokeColor:'#FF3300',
                                 strokeWeight: 10},        
                suppressMarkers:true,
                routeIndex:i };
     

    var map = new google.maps.Map(document.getElementById("map"),mapOptions);
    console.log(trips.length);

    for (var i = 0; i < trips.length; i++) {
              
      console.log(trips[i].destination);
      console.log(trips[i].currentLoc);


      var request = {
      origin: trips[i].currentLoc,
      destination: trips[i].destination,
      travelMode: google.maps.DirectionsTravelMode.DRIVING
    };
 
route[i]=request;
console.log(route.length);
assign();
     
//        var directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);
//        directionsDisplay.setMap(map);

//         directionsService.route(request, function(result, status) {
//         console.log(result);

// if (status == google.maps.DirectionsStatus.OK) {
//     directionsDisplay.setDirections(result);
// }})}

 }
 function call(){
assign();

 }
 function assign(){

//for (var i = 0; i < route.length; i++) {
 var directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);
       directionsDisplay.setMap(map);

        directionsService.route(route[i], function(result, status) {
        console.log(result);

if (status == google.maps.DirectionsStatus.OK) {
    directionsDisplay.setDirections(result);
}})}    
};



 
  google.maps.event.addDomListener(window, 'load', viewTrips);
</script>
<style type="text/css">
  #map {
    width: 500px;
    height: 400px;
    margin-top: 10px; 
  }
</style>
</head>
<script>
  function create_route() {
  // Redirected to create_ride_info in request controller.
     window.location.replace('/requests/create');
}
</script>
<body>
  <div class="container">
      <div style= "position:absolute;padding-top:504px;float:center;right:500px;width:100%;">
          <div class="google-map-filter col-xs-12 col-sm-4  pull-right"  style="width: 60%;border-radius:20px;border:5px solid grey;background-color: #376192;">
            <div id="map"  class="form-group" style="width: 100%;border-radius:20px;border:1px solid grey;"></div>
                     <a class="submit_button" href='#' onClick="create_route();">Submit</a>
           
          </div>

      </div>
  </div>
</body>
</html>